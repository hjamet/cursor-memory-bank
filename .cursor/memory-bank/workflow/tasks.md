# Tasks

**Emoji Legend for Tasks:**
*   ⚪️ TODO
*   🟡 IN_PROGRESS
*   🟢 DONE
*   🔴 BLOCKED
*   🔵 REVIEW

---

🟢 **1. Refactor Commit Message Generation**
    *   **Description**: Modify all rules that use the `mcp_MyMCP_commit` tool to ensure the `description` field is highly verbose, follows a new standardized markdown format, and includes a "Conclusion" section. Define this new standard format within the `context-update.mdc` rule.
    *   **Impacted Rules/Files**:
        *   `context-update.mdc` (define and use new format)
        *   `experience-execution.mdc` (use new format)
        *   `fix.mdc` (use new format)
    *   **Validation**: Commit messages generated by the agent are detailed, adhere to the new markdown structure, and include a comprehensive conclusion. The `context-update.mdc` rule clearly defines this format.

🟢 **2. Update Memory Bank File Formats & Integrate Templates**
    *   **Description**: Remove section titles from `userbrief.md`, `tasks.md`, and `tests.md`. Implement emoji-based status systems for them. Define these new formats directly within the primary rules that manage these files, and delete the old template files from `.cursor/rules/templates/`. Also, consider if context files (`projectBrief.md`, `activeContext.md`, `techContext.md`) should also have sections removed and their structure defined in rules.
    *   **Sub-Tasks**:
        *   🟢 **2.1 `userbrief.md` Refactor**:
            *   **Action**: Modify `consolidate-repo.mdc` to handle `userbrief.md` without section titles, using only emojis (e.g., 🆕 for new, ⏳ for processing, 📌 for precision, 🗄️ for archived) at the start of lines to denote status. Integrate the content/guidance from `userbrief-template.mdc` into `consolidate-repo.mdc`.
            *   **Impacted Rules/Files**: `consolidate-repo.mdc`, `userbrief-template.mdc` (for deletion).
            *   **Validation**: `consolidate-repo.mdc` correctly processes and updates `userbrief.md` using the new emoji-only format. `userbrief-template.mdc` is deleted.
        *   🟢 **2.2 `tasks.md` Refactor**:
            *   **Action**: Modify `task-decomposition.mdc` (and potentially `context-update.mdc` if it modifies tasks status) to handle `tasks.md` without section titles, using an emoji system (⚪️ TODO, 🟡 IN_PROGRESS, 🟢 DONE, 🔴 BLOCKED, 🔵 REVIEW) at the start of task lines. Define this format and emoji legend within `task-decomposition.mdc`. Integrate content/guidance from `task-template.mdc`.
            *   **Impacted Rules/Files**: `task-decomposition.mdc`, `context-update.mdc`, `task-template.mdc` (for deletion).
            *   **Validation**: `tasks.md` uses the new emoji-based format, and rules correctly interact with it. `task-template.mdc` is deleted.
        *   🟢 **2.3 `tests.md` Refactor**:
            *   **Action**: Modify `test-execution.mdc` (and `fix.mdc` if it reads/updates `tests.md`) to handle `tests.md` without section titles. Implement the new format: line 1 `✅{nbr_success} ❌{nbr_fails} ℹ️{nbr_skip}`, followed by a list of only failing/skipped tests with details: `- ❌ Test Name: Description - Progress notes`. Define this format within `test-execution.mdc`. Integrate content/guidance from `tests-template.mdc`.
            *   **Impacted Rules/Files**: `test-execution.mdc`, `fix.mdc`, `tests-template.mdc` (for deletion).
            *   **Validation**: `tests.md` follows the new summary header and failing-tests-only list format. Rules interact correctly. `tests-template.mdc` is deleted.
        *   🟢 **2.4 Context Files (`projectBrief.md`, `activeContext.md`, `techContext.md`) Refactor**:
            *   **Action**: Modify `context-loading.mdc` and `context-update.mdc` to define the structure of these files directly within the rules, removing reliance on section titles if appropriate, or ensuring the rules clearly state the expected (potentially section-less) structure. Integrate content/guidance from `projectBrief-template.mdc`, `activeContext-template.mdc`, `techContext-template.mdc`.
            *   **Impacted Rules/Files**: `context-loading.mdc`, `context-update.mdc`, `projectBrief-template.mdc`, `activeContext-template.mdc`, `techContext-template.mdc` (for deletion).
            *   **Validation**: Context files have their structure/format defined within the rules. Templates are deleted.
        *   🟢 **2.5 Delete Template Files**:
            *   **Action**: Delete all files from the `.cursor/rules/templates/` directory.
            *   **Impacted Files/Directory**: All files in `.cursor/rules/templates/`.
            *   **Validation**: The `.cursor/rules/templates/` directory is empty or deleted.
    *   **Validation (Overall for Task 2)**: All specified memory bank files use their new formats. All rules interacting with them are updated. All template files are deleted, and their essential formatting guidance is now part of the relevant operational rules.

🟢 **3. Update General Rules for Consistency**
    *   **Description**: Review all other relevant workflow rules to ensure they are compatible with the new file formats (e.g., rules that might read these files for context even if they don't primarily manage them). For example, `system.mdc` itself refers to file structures; ensure it's still accurate or update it.
    *   **Impacted Rules/Files**: Potentially any rule, including `system.mdc`.
    *   **Validation**: Workflow remains coherent and functional after all changes.

🟢 **4. Enhance `consolidate-repo` with Memory File Format Validation**
    *   **Description**: Modify `consolidate-repo.mdc`'s "Integrity verification" step to check key memory bank files (`userbrief.md`, `tasks.md`, `tests.md`, `projectBrief.md`, `activeContext.md`, `techContext.md`) against their defined formats. If a format violation is detected, `consolidate-repo.mdc` should call the `request-analysis` rule with a detailed message specifying the incorrect file and the violated format expectation.
    *   **Impacted Rules/Files**:
        *   `.cursor/rules/consolidate-repo.mdc` (Primary modification)
        *   Needs to be aware of formats defined in:
            *   `.cursor/rules/consolidate-repo.mdc` (for `userbrief.md`)
            *   `.cursor/rules/task-decomposition.mdc` (for `tasks.md`)
            *   `.cursor/rules/test-execution.mdc` (for `tests.md`)
            *   `.cursor/rules/context-loading.mdc` & `.cursor/rules/context-update.mdc` (for context files)
    *   **Dependencies**: Sub-tasks 2.3 and 2.4 (ensure formats for `tests.md` and context files are defined).
    *   **Validation**:
        *   `consolidate-repo.mdc` includes logic to read and check the format of specified memory bank files.
        *   Format definitions in managing rules are clear.
        *   If a deliberately malformed memory file is processed by `consolidate-repo.mdc`, it correctly identifies the error and calls `request-analysis`.
    *   **Sub-Tasks**:
        *   🟢 **4.1. Implement Format Definition Access**: Determine how `consolidate-repo.mdc` will access/understand format definitions from other rules. (Decision: Basic checks within `consolidate-repo`, pointers to defining rules in `request-analysis` call).
        *   🟢 **4.2. Implement `userbrief.md` Format Check**: Add logic to `consolidate-repo.mdc` to validate `userbrief.md`.
        *   🟢 **4.3. Implement `tasks.md` Format Check**: Add logic to `consolidate-repo.mdc` to validate `tasks.md`.
        *   🟢 **4.4. Implement `tests.md` Format Check**: Add logic for `tests.md`.
        *   🟢 **4.5. Implement Context Files Format Check**: Add logic for context files.
        *   🟢 **4.6. Implement Conditional `request-analysis` Call**: Add logic to call `request-analysis` on format violation.

🟢 **5. Fix MCP Commit Tool Multi-line Description**
    *   **Description**: The `mcp_MyMCP_commit` tool in the MCP server does not correctly handle multi-line descriptions, leading to malformed commit messages. This task involves investigating the issue, implementing a fix, and verifying it.
    *   **Impacted Rules/Files**: `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js`
    *   **Dependencies**: None.
    *   **Validation**: Multi-line descriptions provided to `mcp_MyMCP_commit` (e.g., by `context-update.mdc`) result in correctly formatted git commit messages, with each line of the description appearing as a separate paragraph in the commit body. Recent malformed commits are reviewed to confirm the nature of the problem.
    *   **Sub-Tasks**:
        *   🟢 **5.1. Investigate Commit Logs**: Review recent git commit logs to observe how multi-line descriptions are currently being malformed. Capture an example of a malformed message.
        *   🟢 **5.2. Implement Fix in `commit.js`**: Modify `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js` to correctly handle multi-line descriptions. This likely involves splitting the input description string by newlines and appending each resulting line as a separate `-m "paragraph"` argument to the `git commit` command, ensuring each part is properly escaped using `escapeShellArg`.
        *   🟢 **5.3. Test and Verify Fix**:
            *   Manually trigger a commit using a rule that generates a multi-line description (e.g., `context-update.mdc` after a minor change, or by creating a temporary test scenario).
            *   Inspect the resulting commit message using `git log -1` or a similar command to ensure it's correctly formatted with multiple paragraphs.
            *   Confirm that the `escapeShellArg` function still correctly handles other special characters within the description paragraphs.

🟢 **6. Enhance MCP Commit Tool with Git Log Output**
    *   **Description**: Modify the `mcp_MyMCP_commit` tool in the MCP server to execute a specific `git log` command after a successful commit and append its output to the success message returned by the tool. This provides immediate visibility into the recent commit history.
    *   **Impacted Rules/Files**: `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js`
    *   **Dependencies**: None.
    *   **Validation**: After a commit is made using `mcp_MyMCP_commit`, the success message includes the output of the specified `git log` command, preceded by a correctly formatted timestamp.
    *   **Sub-Tasks**:
        *   🟢 **6.1. Implement `git log` Execution in `commit.js`**: Modify `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js` to execute the command `echo -e "  Heure actuelle : $(date '+%Y-%m-%d %H:%M:%S')\n" && git log -n 5 --pretty=format:"%C(auto)%h %Cgreen[%an] %Cblue%cd%Creset — %s%n%b" --date=format:"%Y-%m-%d %H:%M:%S" | cat` after a successful commit. Capture its `stdout` and append it to the JSON response's success message. (Initial implementation and subsequent fixes by generating date in JS).
        *   🟢 **6.2. Test and Verify Enhancement**:
            *   Trigger a commit using a rule or manually (e.g., `context-update.mdc` committing a test file).
            *   Verify that the tool's response includes the formatted `git log` output and the correctly formatted timestamp.
            *   Ensure the commit itself is still successful and the primary commit message is not affected.

🟢 **7. Modify `on-edit-tool-fail.mdc` for Manual Intervention**
    *   **Description**: Update the `.cursor/rules/on-edit-tool-fail.mdc` rule. If all automated edit attempts (including full rewrite in Step 5) fail, the rule should interrupt the workflow and instruct the user to perform the edit manually. It must provide details of the file and a code block summarizing the intended changes. Steps 6, 7, and 8 of the rule were also updated to clarify they are only executed if an edit attempt succeeds.
    *   **Impacted Rules/Files**: `.cursor/rules/on-edit-tool-fail.mdc`
    *   **Dependencies**: None.
    *   **Validation**: The `on-edit-tool-fail.mdc` rule incorporates the new logic in its Step 5 for handling complete failure of automated edits, and Steps 6-8 are correctly conditionalized.

🟢 **8. Enhance `context-update` to Comment on Archived Userbrief Tasks**
    *   **Description**: Modify the `.cursor/rules/context-update.mdc` rule to add a new step. This step will involve reading `.cursor/memory-bank/userbrief.md`, identifying tasks marked as archived (🗄️), and checking `.cursor/memory-bank/context/activeContext.md` to determine if the agent "remembers" (i.e., has logged activity related to) processing those tasks. If remembered, the agent should append a comment in the format `-> 🧠 [comment_text]` to the corresponding line in `userbrief.md`. This aims to provide user feedback without interrupting the workflow.
    *   **Impacted Rules/Files**:
        *   `.cursor/rules/context-update.mdc` (Primary modification)
        *   `.cursor/memory-bank/userbrief.md` (Read and modified by the new step)
        *   `.cursor/memory-bank/context/activeContext.md` (Read by the new step)
    *   **Dependencies**: None.
    *   **Validation**:
        *   The `context-update.mdc` rule includes the new step.
        *   When `context-update` runs, if `userbrief.md` contains 🗄️ items that have corresponding entries in `activeContext.md` (indicating they were processed), comments like `-> 🧠 Task acknowledged and processed.` are correctly appended to those items in `userbrief.md`.
        *   Archived items in `userbrief.md` that have no corresponding "memory" in `activeContext.md` are not commented on.
    *   **Sub-Tasks**:
        *   🟢 **8.1. Design `context-update` New Step Logic**
            *   **Description**: Define the precise insertion point and logic for the new step within `context-update.mdc`. This includes reading `userbrief.md` and `activeContext.md`, parsing `userbrief.md` for 🗄️ tasks, implementing the "memory check" against `activeContext.md`, formatting the agent's comment, and editing `userbrief.md`.
            *   **Impacted Rules/Files**: `.cursor/rules/context-update.mdc`.
            *   **Dependencies**: None.
            *   **Validation**: The planned logic is sound and covers all requirements of the feature.
        *   🟢 **8.2. Implement `context-update` Modification**
            *   **Description**: Apply the designed changes to `.cursor/rules/context-update.mdc` using the `edit_file` tool.
            *   **Impacted Rules/Files**: `.cursor/rules/context-update.mdc`.
            *   **Dependencies**: 8.1.
            *   **Validation**: The `edit_file` operation is successful, and the `context-update.mdc` rule is modified as intended.
        *   🟢 **8.3. Test Commenting Feature**
            *   **Description**: Manually prepare a `userbrief.md` with a mix of archived (🗄️) tasks, some of which have plausible corresponding entries in a test `activeContext.md`. Run the modified `context-update` rule (potentially by manually stepping through parts of the workflow or creating a test harness if feasible) and verify that comments are added correctly only to the "remembered" archived tasks.
            *   **Impacted Rules/Files**: `.cursor/memory-bank/userbrief.md` (for test setup), `.cursor/memory-bank/context/activeContext.md` (for test setup), `.cursor/rules/context-update.mdc` (for execution).
            *   **Dependencies**: 8.2.
            *   **Validation**: Comments are correctly appended to targeted 🗄️ items in `userbrief.md`, and not to others. The agent's comment content is appropriate.

🟢 **9. Enhance `fix.mdc` Rule with Git Log Search for Mysterious Problems**
    *   **Description**: Modify the `.cursor/rules/fix.mdc` rule to add a new capability. When confronted with a "mysterious problem" (one not easily solvable by direct analysis, often related to external libraries or frameworks), the agent should use `git log --grep="<keywords>"` to search the Git history for similar past issues, documented solutions, or relevant tests.
    *   **Impacted Rules/Files**:
        *   `.cursor/rules/fix.mdc`
    *   **Dependencies**: None.
    *   **Validation**:
        *   The `fix.mdc` rule includes a new step or logic within its "Correction loop" (likely Step 2.2 Analysis) to trigger a `git log --grep` search under specific conditions (e.g., problem seems "mysterious", multiple failed attempts).
        *   The rule defines how keywords for the grep search are determined.
        *   The example section of `fix.mdc` is updated to illustrate a scenario where this `git log --grep` search is used.
    *   **Sub-Tasks**:
        *   🟢 **9.1. Design and Implement `git log` Search Logic in `fix.mdc`**
            *   **Description**: Define the precise conditions under which the `git log --grep` search is triggered. Determine how the search keywords are formulated. Implement the new logic within Step 2.2 (Analysis) of the `fix.mdc` rule, including the call to `mcp_MyMCP_execute_command` for `git log`.
            *   **Impacted Rules/Files**: `.cursor/rules/fix.mdc`.
            *   **Dependencies**: None.
            *   **Validation**: The `fix.mdc` rule contains the new conditional logic for `git log --grep` search.
        *   🟢 **9.2. Update `fix.mdc` Example Section**
            *   **Description**: Modify the "Example" section of `.cursor/rules/fix.mdc` to include a scenario demonstrating the agent using the `git log --grep` functionality for a mysterious problem.
            *   **Impacted Rules/Files**: `.cursor/rules/fix.mdc`.
            *   **Dependencies**: None.
            *   **Validation**: The example in `fix.mdc` clearly shows the new `git log --grep` step in action.

🟢 **10. Optimize Testing Logic in Rule System**
    *   **Description**: Refactor the testing approach to prioritize manual execution via `experience-execution` over systematic automated test creation. This aims to reduce test complexity and execution time while maintaining code quality through practical verification.
    *   **Impacted Rules/Files**:
        *   `.cursor/rules/implementation.mdc` (modify next rule calling logic)
        *   `.cursor/rules/experience-execution.mdc` (add temporary logging, modify decision logic)
        *   `.cursor/rules/test-implementation.mdc` (restrict usage, emphasize simplicity)
        *   `.cursor/rules/test-execution.mdc` (adjust to be called only after test-implementation)
    *   **Dependencies**: None.
    *   **Validation**: The agent defaults to calling `experience-execution` for testing, only creates tests to "freeze" stable behaviors, and tests remain simple and focused on outputs.
    *   **Sub-Tasks**:
        *   🟢 **10.1. Modify `implementation.mdc` Next Rule Logic**
            *   **Description**: Update Step 5 of `implementation.mdc` to call `experience-execution` by default instead of `test-implementation` when testable features are created or modified.
            *   **Impacted Rules/Files**: `.cursor/rules/implementation.mdc`
            *   **Dependencies**: None.
            *   **Validation**: `implementation.mdc` calls `experience-execution` as the default next rule for testable features.
        *   🟢 **10.2. Enhance `experience-execution.mdc` with Temporary Logging**
            *   **Description**: Add two new steps to `experience-execution.mdc`: one near the beginning to add temporary debug logging to the code being tested, and one near the end to remove this logging if execution was successful (no call to `fix`).
            *   **Impacted Rules/Files**: `.cursor/rules/experience-execution.mdc`
            *   **Dependencies**: None.
            *   **Validation**: `experience-execution.mdc` includes steps for adding and removing temporary debug logging.
        *   🟢 **10.3. Update `experience-execution.mdc` Decision Logic**
            *   **Description**: Modify the final decision logic in `experience-execution.mdc` to optionally call `test-implementation` (only when behaviors need to be "frozen") instead of always proceeding to `context-update`. The rule should call `fix` if problems are detected, `test-implementation` if stable behaviors need to be preserved, or `context-update` if everything works without needing test preservation.
            *   **Impacted Rules/Files**: `.cursor/rules/experience-execution.mdc`
            *   **Dependencies**: 10.2
            *   **Validation**: `experience-execution.mdc` has updated decision logic that can route to `test-implementation` when appropriate.
        *   🟢 **10.4. Restrict and Simplify `test-implementation.mdc`**
            *   **Description**: Modify `test-implementation.mdc` to emphasize that it should only be called to "freeze" stable behaviors that will never change. Update the TLDR, instructions, and specifics to stress: very few tests, simple execution, focus on outputs not internal behavior, avoid mocks, stay close to real usage.
            *   **Impacted Rules/Files**: `.cursor/rules/test-implementation.mdc`
            *   **Dependencies**: None.
            *   **Validation**: `test-implementation.mdc` clearly restricts its usage and emphasizes test simplicity.
        *   🟢 **10.5. Adjust `test-execution.mdc` for New Workflow**
            *   **Description**: Review and adjust `test-execution.mdc` to ensure it works correctly in the new workflow where it's primarily called after `test-implementation` rather than directly after `implementation`.
            *   **Impacted Rules/Files**: `.cursor/rules/test-execution.mdc`
            *   **Dependencies**: 10.1, 10.3, 10.4
            *   **Validation**: `test-execution.mdc` functions correctly in the new testing workflow.

# DONE

3.  **Feature: Ajout de l'outil de capture d'écran web**
    *   [x] **3.1 Implémentation de l'outil `take_webpage_screenshot`**
        *   **Description**: Ajout d'un nouvel outil au serveur MyMCP pour prendre une capture d'écran complète d'une page web via son URL et la retourner en base64.
        *   **Impacted Files/Components**:
            *   `.cursor/mcp/mcp-commit-server/package.json` (ajout de `puppeteer`)
            *   `.cursor/mcp/mcp-commit-server/server.js` (enregistrement de l'outil `take_webpage_screenshot`)
            *   `.cursor/mcp/mcp-commit-server/mcp_tools/webpage_screenshot.js` (logique de l'outil)
        *   **Validation**: L'outil a été testé manuellement avec succès avec l'URL `https://www.webpagetest.org/about` et a retourné une confirmation de génération d'image. Le problème de crash serveur initial a été résolu.

2.  **Enhance MCP Server Testing**
    *   [x] **2.1 Create Python Helper Script for Interruption Test**
        *   **Description**: Create a simple Python script (e.g., `