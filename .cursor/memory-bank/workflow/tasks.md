# Tasks

**Emoji Legend for Tasks:**
*   ‚ö™Ô∏è TODO
*   üü° IN_PROGRESS
*   üü¢ DONE
*   üî¥ BLOCKED
*   üîµ REVIEW

---

üü¢ **1. Refactor Commit Message Generation**
    *   **Description**: Modify all rules that use the `mcp_MyMCP_commit` tool to ensure the `description` field is highly verbose, follows a new standardized markdown format, and includes a "Conclusion" section. Define this new standard format within the `context-update.mdc` rule.
    *   **Impacted Rules/Files**:
        *   `context-update.mdc` (define and use new format)
        *   `experience-execution.mdc` (use new format)
        *   `fix.mdc` (use new format)
    *   **Validation**: Commit messages generated by the agent are detailed, adhere to the new markdown structure, and include a comprehensive conclusion. The `context-update.mdc` rule clearly defines this format.

üü¢ **2. Update Memory Bank File Formats & Integrate Templates**
    *   **Description**: Remove section titles from `userbrief.md`, `tasks.md`, and `tests.md`. Implement emoji-based status systems for them. Define these new formats directly within the primary rules that manage these files, and delete the old template files from `.cursor/rules/templates/`. Also, consider if context files (`projectBrief.md`, `activeContext.md`, `techContext.md`) should also have sections removed and their structure defined in rules.
    *   **Sub-Tasks**:
        *   üü¢ **2.1 `userbrief.md` Refactor**:
            *   **Action**: Modify `consolidate-repo.mdc` to handle `userbrief.md` without section titles, using only emojis (e.g., üÜï for new, ‚è≥ for processing, üìå for precision, üóÑÔ∏è for archived) at the start of lines to denote status. Integrate the content/guidance from `userbrief-template.mdc` into `consolidate-repo.mdc`.
            *   **Impacted Rules/Files**: `consolidate-repo.mdc`, `userbrief-template.mdc` (for deletion).
            *   **Validation**: `consolidate-repo.mdc` correctly processes and updates `userbrief.md` using the new emoji-only format. `userbrief-template.mdc` is deleted.
        *   üü¢ **2.2 `tasks.md` Refactor**:
            *   **Action**: Modify `task-decomposition.mdc` (and potentially `context-update.mdc` if it modifies tasks status) to handle `tasks.md` without section titles, using an emoji system (‚ö™Ô∏è TODO, üü° IN_PROGRESS, üü¢ DONE, üî¥ BLOCKED, üîµ REVIEW) at the start of task lines. Define this format and emoji legend within `task-decomposition.mdc`. Integrate content/guidance from `task-template.mdc`.
            *   **Impacted Rules/Files**: `task-decomposition.mdc`, `context-update.mdc`, `task-template.mdc` (for deletion).
            *   **Validation**: `tasks.md` uses the new emoji-based format, and rules correctly interact with it. `task-template.mdc` is deleted.
        *   üü¢ **2.3 `tests.md` Refactor**:
            *   **Action**: Modify `test-execution.mdc` (and `fix.mdc` if it reads/updates `tests.md`) to handle `tests.md` without section titles. Implement the new format: line 1 `‚úÖ{nbr_success} ‚ùå{nbr_fails} ‚ÑπÔ∏è{nbr_skip}`, followed by a list of only failing/skipped tests with details: `- ‚ùå Test Name: Description - Progress notes`. Define this format within `test-execution.mdc`. Integrate content/guidance from `tests-template.mdc`.
            *   **Impacted Rules/Files**: `test-execution.mdc`, `fix.mdc`, `tests-template.mdc` (for deletion).
            *   **Validation**: `tests.md` follows the new summary header and failing-tests-only list format. Rules interact correctly. `tests-template.mdc` is deleted.
        *   üü¢ **2.4 Context Files (`projectBrief.md`, `activeContext.md`, `techContext.md`) Refactor**:
            *   **Action**: Modify `context-loading.mdc` and `context-update.mdc` to define the structure of these files directly within the rules, removing reliance on section titles if appropriate, or ensuring the rules clearly state the expected (potentially section-less) structure. Integrate content/guidance from `projectBrief-template.mdc`, `activeContext-template.mdc`, `techContext-template.mdc`.
            *   **Impacted Rules/Files**: `context-loading.mdc`, `context-update.mdc`, `projectBrief-template.mdc`, `activeContext-template.mdc`, `techContext-template.mdc` (for deletion).
            *   **Validation**: Context files have their structure/format defined within the rules. Templates are deleted.
        *   üü¢ **2.5 Delete Template Files**:
            *   **Action**: Delete all files from the `.cursor/rules/templates/` directory.
            *   **Impacted Files/Directory**: All files in `.cursor/rules/templates/`.
            *   **Validation**: The `.cursor/rules/templates/` directory is empty or deleted.
    *   **Validation (Overall for Task 2)**: All specified memory bank files use their new formats. All rules interacting with them are updated. All template files are deleted, and their essential formatting guidance is now part of the relevant operational rules.

üü¢ **3. Update General Rules for Consistency**
    *   **Description**: Review all other relevant workflow rules to ensure they are compatible with the new file formats (e.g., rules that might read these files for context even if they don't primarily manage them). For example, `system.mdc` itself refers to file structures; ensure it's still accurate or update it.
    *   **Impacted Rules/Files**: Potentially any rule, including `system.mdc`.
    *   **Validation**: Workflow remains coherent and functional after all changes.

üü¢ **4. Enhance `consolidate-repo` with Memory File Format Validation**
    *   **Description**: Modify `consolidate-repo.mdc`'s "Integrity verification" step to check key memory bank files (`userbrief.md`, `tasks.md`, `tests.md`, `projectBrief.md`, `activeContext.md`, `techContext.md`) against their defined formats. If a format violation is detected, `consolidate-repo.mdc` should call the `request-analysis` rule with a detailed message specifying the incorrect file and the violated format expectation.
    *   **Impacted Rules/Files**:
        *   `.cursor/rules/consolidate-repo.mdc` (Primary modification)
        *   Needs to be aware of formats defined in:
            *   `.cursor/rules/consolidate-repo.mdc` (for `userbrief.md`)
            *   `.cursor/rules/task-decomposition.mdc` (for `tasks.md`)
            *   `.cursor/rules/test-execution.mdc` (for `tests.md`)
            *   `.cursor/rules/context-loading.mdc` & `.cursor/rules/context-update.mdc` (for context files)
    *   **Dependencies**: Sub-tasks 2.3 and 2.4 (ensure formats for `tests.md` and context files are defined).
    *   **Validation**:
        *   `consolidate-repo.mdc` includes logic to read and check the format of specified memory bank files.
        *   Format definitions in managing rules are clear.
        *   If a deliberately malformed memory file is processed by `consolidate-repo.mdc`, it correctly identifies the error and calls `request-analysis`.
    *   **Sub-Tasks**:
        *   üü¢ **4.1. Implement Format Definition Access**: Determine how `consolidate-repo.mdc` will access/understand format definitions from other rules. (Decision: Basic checks within `consolidate-repo`, pointers to defining rules in `request-analysis` call).
        *   üü¢ **4.2. Implement `userbrief.md` Format Check**: Add logic to `consolidate-repo.mdc` to validate `userbrief.md`.
        *   üü¢ **4.3. Implement `tasks.md` Format Check**: Add logic to `consolidate-repo.mdc` to validate `tasks.md`.
        *   üü¢ **4.4. Implement `tests.md` Format Check**: Add logic for `tests.md`.
        *   üü¢ **4.5. Implement Context Files Format Check**: Add logic for context files.
        *   üü¢ **4.6. Implement Conditional `request-analysis` Call**: Add logic to call `request-analysis` on format violation.

üü¢ **5. Fix MCP Commit Tool Multi-line Description**
    *   **Description**: The `mcp_MyMCP_commit` tool in the MCP server does not correctly handle multi-line descriptions, leading to malformed commit messages. This task involves investigating the issue, implementing a fix, and verifying it.
    *   **Impacted Rules/Files**: `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js`
    *   **Dependencies**: None.
    *   **Validation**: Multi-line descriptions provided to `mcp_MyMCP_commit` (e.g., by `context-update.mdc`) result in correctly formatted git commit messages, with each line of the description appearing as a separate paragraph in the commit body. Recent malformed commits are reviewed to confirm the nature of the problem.
    *   **Sub-Tasks**:
        *   üü¢ **5.1. Investigate Commit Logs**: Review recent git commit logs to observe how multi-line descriptions are currently being malformed. Capture an example of a malformed message.
        *   üü¢ **5.2. Implement Fix in `commit.js`**: Modify `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js` to correctly handle multi-line descriptions. This likely involves splitting the input description string by newlines and appending each resulting line as a separate `-m "paragraph"` argument to the `git commit` command, ensuring each part is properly escaped using `escapeShellArg`.
        *   üü¢ **5.3. Test and Verify Fix**:
            *   Manually trigger a commit using a rule that generates a multi-line description (e.g., `context-update.mdc` after a minor change, or by creating a temporary test scenario).
            *   Inspect the resulting commit message using `git log -1` or a similar command to ensure it's correctly formatted with multiple paragraphs.
            *   Confirm that the `escapeShellArg` function still correctly handles other special characters within the description paragraphs.

üü¢ **6. Enhance MCP Commit Tool with Git Log Output**
    *   **Description**: Modify the `mcp_MyMCP_commit` tool in the MCP server to execute a specific `git log` command after a successful commit and append its output to the success message returned by the tool. This provides immediate visibility into the recent commit history.
    *   **Impacted Rules/Files**: `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js`
    *   **Dependencies**: None.
    *   **Validation**: After a commit is made using `mcp_MyMCP_commit`, the success message includes the output of the specified `git log` command, preceded by a correctly formatted timestamp.
    *   **Sub-Tasks**:
        *   üü¢ **6.1. Implement `git log` Execution in `commit.js`**: Modify `.cursor/mcp/mcp-commit-server/mcp_tools/commit.js` to execute the command `echo -e "  Heure actuelle : $(date '+%Y-%m-%d %H:%M:%S')\n" && git log -n 5 --pretty=format:"%C(auto)%h %Cgreen[%an] %Cblue%cd%Creset ‚Äî %s%n%b" --date=format:"%Y-%m-%d %H:%M:%S" | cat` after a successful commit. Capture its `stdout` and append it to the JSON response's success message. (Initial implementation and subsequent fixes by generating date in JS).
        *   üü¢ **6.2. Test and Verify Enhancement**:
            *   Trigger a commit using a rule or manually (e.g., `context-update.mdc` committing a test file).
            *   Verify that the tool's response includes the formatted `git log` output and the correctly formatted timestamp.
            *   Ensure the commit itself is still successful and the primary commit message is not affected.

üü¢ **7. Modify `on-edit-tool-fail.mdc` for Manual Intervention**
    *   **Description**: Update the `.cursor/rules/on-edit-tool-fail.mdc` rule. If all automated edit attempts (including full rewrite in Step 5) fail, the rule should interrupt the workflow and instruct the user to perform the edit manually. It must provide details of the file and a code block summarizing the intended changes. Steps 6, 7, and 8 of the rule were also updated to clarify they are only executed if an edit attempt succeeds.
    *   **Impacted Rules/Files**: `.cursor/rules/on-edit-tool-fail.mdc`
    *   **Dependencies**: None.
    *   **Validation**: The `on-edit-tool-fail.mdc` rule incorporates the new logic in its Step 5 for handling complete failure of automated edits, and Steps 6-8 are correctly conditionalized.

# DONE

3.  **Feature: Ajout de l'outil de capture d'√©cran web**
    *   [x] **3.1 Impl√©mentation de l'outil `take_webpage_screenshot`**
        *   **Description**: Ajout d'un nouvel outil au serveur MyMCP pour prendre une capture d'√©cran compl√®te d'une page web via son URL et la retourner en base64.
        *   **Impacted Files/Components**:
            *   `.cursor/mcp/mcp-commit-server/package.json` (ajout de `puppeteer`)
            *   `.cursor/mcp/mcp-commit-server/server.js` (enregistrement de l'outil `take_webpage_screenshot`)
            *   `.cursor/mcp/mcp-commit-server/mcp_tools/webpage_screenshot.js` (logique de l'outil)
        *   **Validation**: L'outil a √©t√© test√© manuellement avec succ√®s avec l'URL `https://www.webpagetest.org/about` et a retourn√© une confirmation de g√©n√©ration d'image. Le probl√®me de crash serveur initial a √©t√© r√©solu.

2.  **Enhance MCP Server Testing**
    *   [x] **2.1 Create Python Helper Script for Interruption Test**
        *   **Description**: Create a simple Python script (e.g., `