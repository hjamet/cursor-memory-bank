---
description: Rule to consolidate the repository, manage userbrief.md, and maintain a clean project structure
globs: 
alwaysApply: false
---

## TLDR
Repository consolidation, transformation of user requests into tasks, cleaning userbrief.md, and verification of memory files integrity.

## Repository Structure (for reference)
```
.cursor/memory-bank/  
‚îú‚îÄ‚îÄ context/                 # Project context  
‚îÇ   ‚îú‚îÄ‚îÄ projectBrief.md      # Project global vision  
‚îÇ   ‚îú‚îÄ‚îÄ activeContext.md     # Current work context  
‚îÇ   ‚îî‚îÄ‚îÄ techContext.md       # Technologies and dependencies  
‚îú‚îÄ‚îÄ workflow/                # Workflow management  
‚îÇ   ‚îú‚îÄ‚îÄ tasks.md             # List of tasks to accomplish
‚îÇ   ‚îî‚îÄ‚îÄ tests.md             # Test results tracking
src/                         # Project source scripts  
tests/                       # Unit and integration tests  
```

## Instructions

1. **Processing userbrief.md**: Analyze and transform content:
   - Read content from "User Input" section in `.cursor/memory-bank/userbrief.md` (lines starting with `-`)
   - Identify content type: tasks or preferences
   - For tasks: mark with ‚è≥ and move to "Processing"
   - For preferences: mark with üìå and move to "Precisions"
   - Don't convert tasks for tasks.md yet (this will be done by task-decomposition)

2. **Organizing userbrief.md**: Structure content according to template:
   - Maintain sections: "User Input", "Processing", "Precisions" (and potentially "Archives", although this rule doesn't interact with it)
   - Apply appropriate statuses:
     - - : To be processed (in "User Input")
     - ‚è≥ : In processing (in "Processing", for tasks only)
     - üìå : Long-term preference (in "Precisions")
     - (Do not use üóÑÔ∏è or ‚úÖ - these are handled by other rules)
   - Ensure structure remains clear and readable

3. **Integrity verification**: Control of memory files:
   - Use the MCP command execution tool via Git Bash to list all markdown files: `mcp_MyMCP_execute_command(command = "\"C:\\Program Files\\Git\\bin\\bash.exe\" -c \"find . -type f -name '*.md'\"")`
   - Analyze results to find duplicates in memory-bank directories
   - Merge content of duplicate files with main files (using file edit tools)
   - Delete duplicates after merging using the MCP command execution tool via Git Bash (e.g., `mcp_MyMCP_execute_command(command = "\"C:\\Program Files\\Git\\bin\\bash.exe\" -c \"rm <duplicate_file_path>\""")`)
   - Verify all memory files are in the right place

4. **MCP Terminal Cleanup**: Clean up finished terminal processes.
   - Call `mcp_get_terminal_status` to check the status of running/finished processes.
   - For each process with a final status (e.g., 'FINISHED', 'ERROR'), call `mcp_stop_terminal_command` with its `pid` to release resources.

5. **Cleanup task identification**: Generate tasks for tasks.md:
   - Identify unnecessary temporary files
   - Locate misplaced files
   - List necessary cleanup actions
   - Add these tasks to `.cursor/memory-bank/workflow/tasks.md` (without executing them directly)

6. **Evaluation of user requests**: Decide next workflow step:
   - IF new requests identified in userbrief.md:
     - Clearly formulate user request extracted from userbrief.md
     - Call `request-analysis` rule to process this request
   - ELSE:
     - Call `context-update` rule to continue workflow

## Specifics

- Only structure and organization can be modified
- User requests must always be processed with priority
- Duplicates must be carefully merged to lose no information
- Files to be deleted should be deleted only after merging and using the MCP command execution tool (`mcp_MyMCP_execute_command`) with Git Bash to run the `rm` command (not the `delete_file` tool because of a bug)
- This rule should only be called by context-update when structure problems are detected
- IMPORTANT: Only this rule is authorized to modify userbrief.md to move items from "User Input" to "Processing" or "Precisions".
- IMPORTANT: Mark new tasks from "User Input" with ‚è≥ (only) and move to "Processing". Mark preferences with üìå and move to "Precisions".
- IMPORTANT: Never use ‚úÖ or üóÑÔ∏è in this rule; these are handled by `task-decomposition`.

## Next Rules

- `request-analysis` - If new requests identified in userbrief.md
- `context-update` - If no new request identified in userbrief.md

## Example

# Consolidate-repo: 1 - Processing userbrief.md  
I begin by analyzing the content of `.cursor/memory-bank/userbrief.md`. **(Consolidate-repo: 1 - Processing userbrief.md)**  
[...reading and analyzing userbrief.md content...]  
I've identified several user requests that I will mark as follows:  
- Tasks to perform: ‚è≥ (moving to "Processing")  
- Long-term preferences: üìå (moving to "Precisions")  
**(Consolidate-repo: 1 - Processing userbrief.md)**  

# Consolidate-repo: 2 - Organizing userbrief.md  
I'm now reorganizing the content of `.cursor/memory-bank/userbrief.md` according to the 3-section structure. **(Consolidate-repo: 2 - Organizing userbrief.md)**  
[...content reorganization...]  
I've applied appropriate statuses to the different elements.  
**(Consolidate-repo: 2 - Organizing userbrief.md)**  

# Consolidate-repo: 3 - Integrity verification  
I'm now verifying the integrity of memory files using MCP via Git Bash. **(Consolidate-repo: 3 - Integrity verification)**  
[...calling tool `mcp_MyMCP_execute_command` with command="\"C:\\Program Files\\Git\\bin\\bash.exe\" -c \"find . -type f -name '*.md'\""...]
[...analyzing command results...]
I've identified some duplicates that I've merged with the main files. Removing duplicates using MCP via Git Bash.
[...calling tool `mcp_MyMCP_execute_command` with command="\"C:\\Program Files\\Git\\bin\\bash.exe\" -c \"rm <duplicate_file_path>\"" for each duplicate...]
**(Consolidate-repo: 3 - Integrity verification)**  

# Consolidate-repo: 4 - MCP Terminal Cleanup  
I'm now checking MCP terminal processes for cleanup. **(Consolidate-repo: 4 - MCP Terminal Cleanup)**  
Calling `mcp_get_terminal_status`...  
[...retrieving process statuses...]  
I've found some finished processes (`FINISHED`, `ERROR`). Stopping these with `mcp_stop_terminal_command` to free up resources.  
Cleanup complete.  
**(Consolidate-repo: 4 - MCP Terminal Cleanup)**  

# Consolidate-repo: 5 - Cleanup task identification  
I'm now identifying necessary cleanup tasks. **(Consolidate-repo: 5 - Cleanup task identification)**  
[...task identification...]  
I've added these tasks to `.cursor/memory-bank/workflow/tasks.md` for later validation.  
**(Consolidate-repo: 5 - Cleanup task identification)**  

# Consolidate-repo: 6 - Evaluation of user requests  
I'm now evaluating if I've identified new user requests. **(Consolidate-repo: 6 - Evaluation of user requests)**  
I found the following requests in the userbrief.md file:  
- [Summary of extracted requests]  

I will now call the `request-analysis` rule to process these requests.  
**(Consolidate-repo: 6 - Evaluation of user requests)**  

[...] (The workflow must continue uninterrupted: even if the example stops here, the agent must IMPERATIVELY continue in reality: it MUST call and execute the following rule, then the next, etc., without ever stopping -> It is completely autonomous.)  